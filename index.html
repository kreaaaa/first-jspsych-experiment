<!DOCTYPE html>
<html>
    <head>
        <title> my experiment </title>
        <script src="https://unpkg.com/jspsych@7.3.3"></script>
        <script src="https://unpkg.com/@jspsych/plugin-html-keyboard-response@2.0.0"></script>
        <link href="https://unpkg.com/jspsych@8.0.0/css/jspsych.css" rel="stylesheet" type="text/css">
        <script src="https://unpkg.com/@jspsych/plugin-survey-text@1.1.3"></script>
        <script src= "jspsych/modified-image-plugin.js"></script>
        <script src= "all_sentences.js"></script>
        <script src= "association.js"></script>
        <script src= "priming.js"></script>
        <script src="https://unpkg.com/@jspsych/plugin-instructions@1.1.4"></script>
    
        
</head>
<body>

</body>
<script>
    
const jsPsych = initJsPsych();

var random_attention_trials = jsPsych.randomization.sampleWithoutReplacement([...Array(35).keys()].map(x => x+5),3);

console.log("random_attention_trials= " + random_attention_trials);
//can check the trial numbers w command option I and console

var initial_instructions = {
    type: jsPsychInstructions,
    pages: [
    'page 1 instructions.',
    'page 2 instructions.',
    'page 3 instructions.'
    ],
    show_clickable_nav: true
}

var sentence_number = 0 ;

var sentence = {
    type: jsPsychHtmlKeyboardResponse,
    stimulus: jsPsych.timelineVariable('sentence'),
    choices: [' '],
    trial_duration: 10,
    on_finish: function(data) {
        sentence_number = (sentence_number + 1 ) % 40;
        console.log ("sentence_number = " + sentence_number);
    }
};
//string sentences mapping onto string of the sentences

var attention = {
    type: jsPsychSurveyText,
    questions: [{prompt: "Type any ONE novel word from the previous sentence:"}],
//two forward slashes to take notes
};

var attention_conditional = {
    timeline: [attention],
    conditional_function: function () {
        if(random_attention_trials.includes(sentence_number)){return true;} else {return false;}
    }
}

var association_instructions = {
    type: jsPsychInstructions,
    pages: [
    'Done with sentences. Association time.'
    ],
    show_clickable_nav: true
}

var association = {
    type: jsPsychSurveyText,
    questions: [{prompt: jsPsych.timelineVariable('cue')}],
};

var priming_instructions = {
    type: jsPsychInstructions,
    pages: [
    'Priming task about to begin.'
    ],
    show_clickable_nav: true
}

var slow_experiment_trial = {
    type: jsPsychHtmlKeyboardResponse,
    stimulus: "<b> Speed up kiddo</b>! <br><br> Please please please respond faster.",
    choices: "NO_KEYS",
    trial_duration: 1000,
}

var fixation = {
    type: jsPsychHtmlKeyboardResponse,
    stimulus: "+",
    choices : "NO_KEYS",
    trial_duration: 500 ,
    //NO_KEYS is js psych specific and will not let the participant move on by pressing keys
};

var image = {
    type: jsPsychImageKeyboardResponse,
    stimulus: jsPsych.timelineVariable('image_path'),
    choices : "NO_KEYS",
    trial_duration: 500 ,
      stimulus_width: 500 ,
      maintain_aspect_ratio: true,
    };

var prime = {
    type: jsPsychImageKeyboardResponse,
    stimulus: jsPsych.timelineVariable('image_path'),
    //trial_duration: 300
    choices : "NO_KEYS",
    trial_duration: 500 ,
      stimulus_width: 500 ,
      maintain_aspect_ratio: true,
      prompt: function (){
            return "<span style = 'font size: 300%'><br>" + String(jsPsych.timelineVariable('prime_word'))+"<br></span>";
      }
}

var target = {
    type: jsPsychImageKeyboardResponse,
    stimulus: jsPsych.timelineVariable('image_path'),
    //trial_duration: 300
    choices : ['A', 'L'],
      stimulus_width: 500 ,
      maintain_aspect_ratio: true,
      prompt:  function (){
        return "<span style = 'font size: 300%'><br>" + String(jsPsych.timelineVariable('target_word'))+"<br></span>";
}
}

var priming_feedback = {
    timeline: [slow_experiment_trial],
    conditional_function: function(){
        //get the data from previous trial
        //and check if rt is 800 ms
        var rt = jsPsych.data.get().last(1).values()[0].rt;
        if (rt > 800) {
            return true;
        } else{
            return false;
        }
    }
}


var priming_procedure = {
    timeline: [fixation, image, prime, target, priming_feedback],
    timeline_variables : practice_stimuli,
    randomize_order: true
}

var training_procedure = {
    timeline: [sentence, attention_conditional],
    timeline_variables: sentence,
    randomize_order: true
};


var association_procedure = {
    timeline: [association],
    timeline_variables: association_cues,
    randomize_order: true,
    repetitions: 3
};

var training_plus_association = {
    timeline: [ training_procedure, association_instructions, association_procedure],
    repetitions: 3
};

//jsPsych.run([initial_instructions, training_plus_association, priming_instructions, priming_procedure]);
jsPsych.run([priming_procedure])

  </script>
</html>